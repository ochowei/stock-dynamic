
import { StockDataPoint } from '../types';

const rawCsvData = `Datetime,Open,High,Low,Close,Volume,P_buy,P_sell,price_diff,return
2025-09-18 09:30:00-04:00,6.28000020980835,6.360000133514404,6.010000228881836,6.045000076293945,9035394,6.284999847412109,6.045000076293945,-0.23999977111816406,-0.03818612202782878
2025-09-18 10:30:00-04:00,6.045000076293945,6.25,6.010000228881836,6.2459001541137695,5375087,6.329999923706055,6.2459001541137695,-0.08409976959228516,-0.01328590372921314
2025-09-18 11:30:00-04:00,6.247499942779541,6.349999904632568,6.199999809265137,6.340000152587891,5322658,6.319799900054932,6.340000152587891,0.020200252532958984,0.003196343690056295
2025-09-18 12:30:00-04:00,6.339900016784668,6.510000228881836,6.329999923706055,6.375,4789060,6.304999828338623,6.375,0.07000017166137695,0.01110232729059758
2025-09-18 13:30:00-04:00,6.369999885559082,6.409999847412109,6.320000171661377,6.385000228881836,2145033,6.44379997253418,6.385000228881836,-0.05879974365234375,-0.00912501069290941
2025-09-18 14:30:00-04:00,6.382599830627441,6.609799861907959,6.380000114440918,6.605000019073486,4066709,6.414999961853027,6.605000019073486,0.19000005722045898,0.029618091714777788
2025-09-18 15:30:00-04:00,6.600200176239014,6.639999866485596,6.489999771118164,6.610000133514404,4962434,6.389999866485596,6.610000133514404,0.2200002670288086,0.03442883750008675
2025-09-19 09:30:00-04:00,6.548099994659424,6.729899883270264,6.460000038146973,6.53000020980835,8300699,6.019899845123291,6.53000020980835,0.5101003646850586,0.0847356895976085
2025-09-19 10:30:00-04:00,6.53000020980835,6.670000076293945,6.420000076293945,6.649799823760986,7444505,6.0,6.649799823760986,0.6497998237609863,0.10829997062683105
2025-09-19 11:30:00-04:00,6.641200065612793,6.789999961853027,6.590000152587891,6.672500133514404,6727231,6.074999809265137,6.672500133514404,0.5975003242492676,0.09835396592737412
2025-09-19 12:30:00-04:00,6.675000190734863,6.840000152587891,6.619999885559082,6.815000057220459,2894993,6.070000171661377,6.815000057220459,0.744999885559082,0.12273473879576076
2025-09-19 13:30:00-04:00,6.815000057220459,6.829999923706055,6.650000095367432,6.664999961853027,2580839,6.159999847412109,6.664999961853027,0.505000114440918,0.08198054008931098
2025-09-19 14:30:00-04:00,6.659999847412109,6.710000038146973,6.599999904632568,6.690000057220459,2375297,6.081900119781494,6.690000057220459,0.6080999374389648,0.09998518973718565
2025-09-19 15:30:00-04:00,6.68720006942749,6.78000020980835,6.664999961853027,6.699999809265137,4329267,6.079999923706055,6.699999809265137,0.619999885559082,0.10197366666760779
2025-09-22 09:30:00-04:00,6.820000171661377,7.25,6.580100059509277,7.116799831390381,20672133,6.03000020980835,7.116799831390381,1.0867996215820312,0.18023210344408475
2025-09-22 10:30:00-04:00,7.119900226593018,7.300000190734863,7.020100116729736,7.243599891662598,6552673,6.119999885559082,7.243599891662598,1.1236000061035156,0.1835947756722664
2025-09-22 11:30:00-04:00,7.244999885559082,7.360000133514404,7.130000114440918,7.229899883270264,6695221,6.034999847412109,7.229899883270264,1.1949000358581543,0.1979950399452858
2025-09-22 12:30:00-04:00,7.221199989318848,7.269999980926514,7.099999904632568,7.18720006942749,3375467,5.934999942779541,7.18720006942749,1.2522001266479492,0.21098570155360538
2025-09-22 13:30:00-04:00,7.183499813079834,7.289999961853027,7.154099941253662,7.260000228881836,3304973,5.956699848175049,7.260000228881836,1.303300380706787,0.2187957113713021
2025-09-22 14:30:00-04:00,7.260000228881836,7.335000038146973,7.25,7.324999809265137,3884410,6.144999980926514,7.324999809265137,1.179999828338623,0.19202601008970357
2025-09-22 15:30:00-04:00,7.324999809265137,7.340000152587891,7.215000152587891,7.260000228881836,3168543,6.105000019073486,7.260000228881836,1.1550002098083496,0.18918922296475865
2025-09-23 09:30:00-04:00,7.514999866485596,7.610000133514404,7.25,7.365699768066406,10271585,6.045000076293945,7.365699768066406,1.320699691772461,0.21847802731247482
2025-09-23 10:30:00-04:00,7.364999771118164,7.449999809265137,7.269999980926514,7.306000232696533,3944355,6.2459001541137695,7.306000232696533,1.0601000785827637,0.169727349529362
2025-09-23 11:30:00-04:00,7.305699825286865,7.47760009765625,7.230000019073486,7.420000076293945,3650556,6.340000152587891,7.420000076293945,1.0799999237060547,0.1703469870210043
2025-09-23 12:30:00-04:00,7.42609977722168,7.900000095367432,7.4116997718811035,7.690100193023682,6233740,6.375,7.690100193023682,1.3151001930236816,0.20629022635665595
2025-09-23 13:30:00-04:00,7.695000171661377,7.764999866485596,7.380000114440918,7.735000133514404,4866545,6.385000228881836,7.735000133514404,1.3499999046325684,0.21143302368667027
2025-09-23 14:30:00-04:00,7.7399001121521,8.11989974975586,7.7067999839782715,7.979899883270264,23323446,6.605000019073486,7.979899883270264,1.3748998641967773,0.2081604633196717
2025-09-23 15:30:00-04:00,7.980000019073486,8.010000228881836,7.809999942779541,7.889999866485596,6113212,6.610000133514404,7.889999866485596,1.2799997329711914,0.1936459466137168
2025-09-24 09:30:00-04:00,7.989999771118164,8.069999694824219,7.329999923706055,7.534999847412109,11516425,6.53000020980835,7.534999847412109,1.0049996376037598,0.1539049931566933
2025-09-24 10:30:00-04:00,7.539999961853027,7.690000057220459,7.5,7.635000228881836,3404428,6.649799823760986,7.635000228881836,0.9852004051208496,0.1481548965730582
2025-09-24 11:30:00-04:00,7.6356000900268555,7.6356000900268555,7.330100059509277,7.465000152587891,4911925,6.672500133514404,7.465000152587891,0.7925000190734863,0.11877107579105836
2025-09-24 12:30:00-04:00,7.465000152587891,7.559999942779541,7.409999847412109,7.480100154876709,2114486,6.815000057220459,7.480100154876709,0.66510009765625,0.09759355716388876
2025-09-24 13:30:00-04:00,7.483699798583984,7.514999866485596,7.349999904632568,7.394999980926514,2400670,6.664999961853027,7.394999980926514,0.7300000190734863,0.1095273853340772
2025-09-24 14:30:00-04:00,7.389900207519531,7.46999979019165,7.264999866485596,7.28000020980835,2921406,6.690000057220459,7.28000020980835,0.5900001525878906,0.08819135239783871
2025-09-24 15:30:00-04:00,7.284999847412109,7.400000095367432,7.25,7.340000152587891,2810672,6.699999809265137,7.340000152587891,0.6400003433227539,0.09552244202122595
2025-09-25 09:30:00-04:00,7.005000114440918,7.670000076293945,6.789999961853027,7.526199817657471,24254390,7.116799831390381,7.526199817657471,0.40939998626708984,0.05752585374978953
2025-09-25 10:30:00-04:00,7.5279998779296875,7.739999771118164,7.425000190734863,7.46120023727417,0,7.243599891662598,7.46120023727417,0.21760034561157227,0.030040359609319507
2025-09-25 11:30:00-04:00,7.460000038146973,7.675000190734863,7.454999923706055,7.474999904632568,4179260,7.229899883270264,7.474999904632568,0.2451000213623047,0.03390088733171224
2025-09-25 12:30:00-04:00,7.46999979019165,7.550000190734863,7.300000190734863,7.349999904632568,3899535,7.18720006942749,7.349999904632568,0.16279983520507812,0.02265135708376715
2025-09-25 13:30:00-04:00,7.340000152587891,7.505000114440918,7.239999771118164,7.485000133514404,2798567,7.260000228881836,7.485000133514404,0.22499990463256836,0.030991721424122074
2025-09-25 14:30:00-04:00,7.480000019073486,7.840000152587891,7.480000019073486,7.769999980926514,5447277,7.324999809265137,7.769999980926514,0.44500017166137695,0.06075087825920647
2025-09-25 15:30:00-04:00,7.769999980926514,7.840000152587891,7.699999809265137,7.760000228881836,3600015,7.260000228881836,7.760000228881836,0.5,0.06887052124473673
2025-09-26 09:30:00-04:00,7.695000171661377,7.889999866485596,7.420100212097168,7.48769998550415,6460797,7.365699768066406,7.48769998550415,0.12200021743774414,0.01656328947409308
2025-09-26 10:30:00-04:00,7.480000019073486,7.630000114440918,7.360000133514404,7.539999961853027,4128664,7.306000232696533,7.539999961853027,0.23399972915649414,0.032028431659401745
2025-09-26 11:30:00-04:00,7.53000020980835,7.605000019073486,7.430300235748291,7.586599826812744,2993909,7.420000076293945,7.586599826812744,0.16659975051879883,0.022452796335011647
2025-09-26 12:30:00-04:00,7.579999923706055,7.820000171661377,7.568600177764893,7.795000076293945,2925797,7.690100193023682,7.795000076293945,0.10489988327026367,0.013640899420975936
2025-09-26 13:30:00-04:00,7.789999961853027,7.889999866485596,7.619999885559082,7.644999980926514,3721986,7.735000133514404,7.644999980926514,-0.09000015258789062,-0.011635442926230304
2025-09-26 14:30:00-04:00,7.639999866485596,7.739999771118164,7.590000152587891,7.6057000160217285,1669479,7.979899883270264,7.6057000160217285,-0.37419986724853516,-0.046892802255958044
2025-09-26 15:30:00-04:00,7.599999904632568,7.684999942779541,7.539999961853027,7.659999847412109,4607493,7.889999866485596,7.659999847412109,-0.23000001907348633,-0.029150826738344942
2025-09-29 09:30:00-04:00,7.96999979019165,8.710000038146973,7.962900161743164,8.59469985961914,17094571,7.534999847412109,8.59469985961914,1.0597000122070312,0.1406370316743914
2025-09-29 10:30:00-04:00,8.590100288391113,8.680000305175781,8.369999885559082,8.399999618530273,6505594,7.635000228881836,8.399999618530273,0.7649993896484375,0.10019638070927386
2025-09-29 11:30:00-04:00,8.39009952545166,8.40999984741211,8.199999809265137,8.305000305175781,5870501,7.465000152587891,8.305000305175781,0.8400001525878906,0.1125251353540412
2025-09-29 12:30:00-04:00,8.300000190734863,8.444999694824219,8.125,8.164999961853027,4335007,7.480100154876709,8.164999961853027,0.6848998069763184,0.09156291931863943
2025-09-29 13:30:00-04:00,8.164999961853027,8.180000305175781,7.980000019073486,8.010000228881836,4409949,7.394999980926514,8.010000228881836,0.6150002479553223,0.08316433394747208
2025-09-29 14:30:00-04:00,8.009599685668945,8.15999984741211,7.914999961853027,7.920000076293945,4097162,7.28000020980835,7.920000076293945,0.6399998664855957,0.08791206703858653
2025-09-29 15:30:00-04:00,7.929999828338623,7.960000038146973,7.800000190734863,7.880000114440918,4158809,7.340000152587891,7.880000114440918,0.5399999618530273,0.07356947556229104
2025-09-30 09:30:00-04:00,7.929999828338623,8.170000076293945,7.730000019073486,7.899899959564209,7394365,7.526199817657471,7.899899959564209,0.3737001419067383,0.04965323150602351
2025-09-30 10:30:00-04:00,7.894999980926514,8.147500038146973,7.849999904632568,8.005000114440918,4122736,7.46120023727417,8.005000114440918,0.543799877166748,0.07288369965599752
2025-09-30 11:30:00-04:00,8.000100135803223,8.0600004196167,7.809999942779541,7.829999923706055,3654774,7.474999904632568,7.829999923706055,0.35500001907348633,0.047491641953530735
2025-09-30 12:30:00-04:00,7.840000152587891,7.925000190734863,7.704999923706055,7.75,2338431,7.349999904632568,7.75,0.40000009536743164,0.05442178238877514
2025-09-30 13:30:00-04:00,7.755000114440918,7.755000114440918,7.570000171661377,7.684999942779541,3401962,7.485000133514404,7.684999942779541,0.19999980926513672,0.026720080921525856
2025-09-30 14:30:00-04:00,7.684500217437744,7.78000020980835,7.630000114440918,7.710100173950195,2147464,7.769999980926514,7.710100173950195,-0.05989980697631836,-0.007709112885889063
2025-09-30 15:30:00-04:00,7.71999979019165,7.79010009765625,7.664999961853027,7.710000038146973,2420970,7.760000228881836,7.710000038146973,-0.05000019073486328,-0.006443323358260773
2025-10-01 09:30:00-04:00,7.739999771118164,7.8881001472473145,7.610000133514404,7.8420000076293945,4945398,7.48769998550415,7.8420000076293945,0.35430002212524414,0.04731760391190259
2025-10-01 10:30:00-04:00,7.849999904632568,7.929999828338623,7.710000038146973,7.886000156402588,4008479,7.539999961853027,7.886000156402588,0.34600019454956055,0.045888620198948606
2025-10-01 11:30:00-04:00,7.889999866485596,7.949900150299072,7.760000228881836,7.822500228881836,2207124,7.586599826812744,7.822500228881836,0.2359004020690918,0.031094351548023782
2025-10-01 12:30:00-04:00,7.824999809265137,7.835000038146973,7.599999904632568,7.614200115203857,2561266,7.795000076293945,7.614200115203857,-0.1807999610900879,-0.023194350137331548
2025-10-01 13:30:00-04:00,7.619999885559082,7.619999885559082,7.269999980926514,7.304999828338623,14705612,7.644999980926514,7.304999828338623,-0.3400001525878906,-0.04447353216954296
2025-10-01 14:30:00-04:00,7.30649995803833,7.349999904632568,7.179999828338623,7.21589994430542,5692554,7.6057000160217285,7.21589994430542,-0.3898000717163086,-0.05125104472897672
2025-10-01 15:30:00-04:00,7.215000152587891,7.320000171661377,7.210000038146973,7.320000171661377,4769931,7.659999847412109,7.320000171661377,-0.3399996757507324,-0.04438638153049044
2025-10-02 09:30:00-04:00,7.795000076293945,8.989899635314941,7.659999847412109,8.765000343322754,36691875,8.59469985961914,8.765000343322754,0.17030048370361328,0.019814593468672898
2025-10-02 10:30:00-04:00,8.765000343322754,8.850000381469727,8.29010009765625,8.725000381469727,16392251,8.399999618530273,8.725000381469727,0.3250007629394531,0.038690568773658784
2025-10-02 11:30:00-04:00,8.727100372314453,9.34000015258789,8.694999694824219,9.149999618530273,19393513,8.305000305175781,9.149999618530273,0.8449993133544922,0.10174584976569813
2025-10-02 12:30:00-04:00,9.149999618530273,9.279999732971191,9.050000190734863,9.113300323486328,9507113,8.164999961853027,9.113300323486328,0.9483003616333008,0.1161421146434502
2025-10-02 13:30:00-04:00,9.112700462341309,9.197999954223633,9.0,9.125,6960914,8.010000228881836,9.125,1.114999771118164,0.1392009661994496
2025-10-02 14:30:00-04:00,9.119999885559082,9.270000457763672,9.039999961853027,9.15530014038086,7266904,7.920000076293945,9.15530014038086,1.235300064086914,0.1559722288115123
2025-10-02 15:30:00-04:00,9.153300285339355,9.260000228881836,9.100000381469727,9.210000038146973,5772673,7.880000114440918,9.210000038146973,1.3299999237060547,0.1687817137551422
2025-10-03 09:30:00-04:00,9.510000228881836,10.279999732971191,9.220000267028809,9.545000076293945,30584788,7.899899959564209,9.545000076293945,1.6451001167297363,0.20824315816025685
2025-10-03 10:30:00-04:00,9.54990005493164,9.960000038146973,9.524999618530273,9.691300392150879,11468056,8.005000114440918,9.691300392150879,1.686300277709961,0.21065587178042594
2025-10-03 11:30:00-04:00,9.699899673461914,9.880000114440918,9.630000114440918,9.734999656677246,6321040,7.829999923706055,9.734999656677246,1.9049997329711914,0.24329498742440944
2025-10-03 12:30:00-04:00,9.729999542236328,9.765000343322754,9.329999923706055,9.369999885559082,7010725,7.75,9.369999885559082,1.619999885559082,0.20903224329794606
2025-10-03 13:30:00-04:00,9.369999885559082,9.669899940490723,9.190099716186523,9.664999961853027,6458899,7.684999942779541,9.664999961853027,1.9800000190734863,0.25764476692466337
2025-10-03 14:30:00-04:00,9.669300079345703,9.854999542236328,9.569999694824219,9.853799819946289,4045535,7.710100173950195,9.853799819946289,2.1436996459960938,0.2780378461539223
2025-10-03 15:30:00-04:00,9.854999542236328,9.970000267028809,9.800000190734863,9.899999618530273,5258424,7.710000038146973,9.899999618530273,2.189999580383301,0.28404663677662534
2025-10-06 09:30:00-04:00,10.569999694824219,11.625,10.539999961853027,10.779999732971191,36050956,7.8420000076293945,10.779999732971191,2.937999725341797,0.37464928876351056
2025-10-06 10:30:00-04:00,10.774999618530273,10.899999618530273,10.515000343322754,10.547200202941895,9571880,7.886000156402588,10.547200202941895,2.6612000465393066,0.3374587869337914
2025-10-06 11:30:00-04:00,10.545000076293945,10.630000114440918,10.380000114440918,10.460000038146973,9106341,7.822500228881836,10.460000038146973,2.6374998092651367,0.3371683901685416
2025-10-06 12:30:00-04:00,10.45009994506836,10.489899635314941,10.270000457763672,10.380000114440918,8911980,7.614200115203857,10.380000114440918,2.7657999992370605,0.36324235735732446
2025-10-06 13:30:00-04:00,10.384400367736816,10.880000114440918,10.3100004196167,10.654999732971191,7216351,7.304999828338623,10.654999732971191,3.3499999046325684,0.4585900045660178
2025-10-06 14:30:00-04:00,10.654999732971191,10.899999618530273,10.635000228881836,10.815600395202637,4996962,7.21589994430542,10.815600395202637,3.599700450897217,0.49885675780995226
2025-10-06 15:30:00-04:00,10.8149995803833,10.850000381469727,10.579999923706055,10.675000190734863,4936153,7.320000171661377,10.675000190734863,3.3550000190734863,0.4583333251906225
2025-10-07 09:30:00-04:00,11.0,11.545000076293945,10.850000381469727,10.99370002746582,17754439,8.765000343322754,10.99370002746582,2.2286996841430664,0.25427262941762546
2025-10-07 10:30:00-04:00,10.999899864196777,11.119999885559082,10.619999885559082,10.805000305175781,9797530,8.725000381469727,10.805000305175781,2.0799999237060547,0.2383953963054932
2025-10-07 11:30:00-04:00,10.800000190734863,10.835000038146973,10.449999809265137,10.800000190734863,7691645,9.149999618530273,10.800000190734863,1.6500005722045898,0.18032793890647425
2025-10-07 12:30:00-04:00,10.807999610900879,11.0,10.755000114440918,10.854999542236328,4031094,9.113300323486328,10.854999542236328,1.74169921875,0.1911161880906506
2025-10-07 13:30:00-04:00,10.850000381469727,10.989999771118164,10.812199592590332,10.835000038146973,2953786,9.125,10.835000038146973,1.7100000381469727,0.18739726445446275
2025-10-07 14:30:00-04:00,10.835000038146973,11.25,10.78499984741211,11.20009994506836,5082519,9.15530014038086,11.20009994506836,2.0447998046875,0.22334601524078887
2025-10-07 15:30:00-04:00,11.204999923706055,11.258199691772461,11.0,11.069999694824219,5803129,9.210000038146973,11.069999694824219,1.859999656677246,0.20195435928048847
2025-10-08 09:30:00-04:00,11.270000457763672,11.413700103759766,10.720000267028809,10.9399995803833,13043192,9.545000076293945,10.9399995803833,1.3949995040893555,0.14614976353473164
2025-10-08 10:30:00-04:00,10.93239974975586,11.170000076293945,10.75,10.78499984741211,5975351,9.691300392150879,10.78499984741211,1.0936994552612305,0.11285373592867198
2025-10-08 11:30:00-04:00,10.788200378417969,11.149999618530273,10.713199615478516,11.13700008392334,4474740,9.734999656677246,11.13700008392334,1.4020004272460938,0.1440164845084982
2025-10-08 12:30:00-04:00,11.13010025024414,11.54990005493164,11.055000305175781,11.509900093078613,6694693,9.369999885559082,11.509900093078613,2.1399002075195312,0.22837782643066162
2025-10-08 13:30:00-04:00,11.506500244140625,11.699899673461914,11.079999923706055,11.121999740600586,6258984,9.664999961853027,11.121999740600586,1.4569997787475586,0.1507501070355115
2025-10-08 14:30:00-04:00,11.125,11.3100004196167,10.9399995803833,11.30150032043457,3940049,9.853799819946289,11.30150032043457,1.4477005004882812,0.14691799376295553
2025-10-08 15:30:00-04:00,11.309700012207031,11.350000381469727,11.21500015258789,11.255000114440918,3838911,9.899999618530273,11.255000114440918,1.3550004959106445,0.136868742234538
2025-10-09 09:30:00-04:00,11.149999618530273,11.390000343322754,10.850000381469727,11.150099754333496,10139283,10.779999732971191,11.150099754333496,0.3701000213623047,0.034332099307046775
2025-10-09 10:30:00-04:00,11.156299591064453,11.15999984741211,10.850000381469727,10.925000190734863,6662746,10.547200202941895,10.925000190734863,0.37779998779296875,0.03581993140583321
2025-10-09 11:30:00-04:00,10.920100212097168,10.920100212097168,10.760000228881836,10.823200225830078,5073805,10.460000038146973,10.823200225830078,0.36320018768310547,0.03472277116238402
2025-10-09 12:30:00-04:00,10.820099830627441,10.850000381469727,10.510000228881836,10.530099868774414,5736761,10.380000114440918,10.530099868774414,0.1500997543334961,0.014460477136669155
2025-10-09 13:30:00-04:00,10.539999961853027,10.770000457763672,10.422599792480469,10.640000343322754,6144334,10.654999732971191,10.640000343322754,-0.0149993896484375,-0.0014077325222283095
2025-10-09 14:30:00-04:00,10.645000457763672,10.654999732971191,10.375,10.435500144958496,3819362,10.815600395202637,10.435500144958496,-0.3801002502441406,-0.035143703202342585
2025-10-09 15:30:00-04:00,10.43120002746582,10.569999694824219,10.380000114440918,10.489999771118164,4036254,10.675000190734863,10.489999771118164,-0.18500041961669922,-0.01733024977154252
2025-10-10 09:30:00-04:00,10.484999656677246,10.510000228881836,9.800000190734863,10.136300086975098,17393329,10.99370002746582,10.136300086975098,-0.8573999404907227,-0.07799011600722779
2025-10-10 10:30:00-04:00,10.135000228881836,10.260000228881836,9.609999656677246,9.679800033569336,13230582,10.805000305175781,9.679800033569336,-1.1252002716064453,-0.10413699581919077
2025-10-10 11:30:00-04:00,9.680000305175781,9.979999542236328,9.369999885559082,9.845000267028809,10008182,10.800000190734863,9.845000267028809,-0.9549999237060547,-0.08842591730001384
2025-10-10 12:30:00-04:00,9.849900245666504,9.899999618530273,9.5600004196167,9.725000381469727,4321237,10.854999542236328,9.725000381469727,-1.1299991607666016,-0.1040994203979304
2025-10-10 13:30:00-04:00,9.725000381469727,9.770000457763672,9.5600004196167,9.5649995803833,3065627,10.835000038146973,9.5649995803833,-1.2700004577636719,-0.11721277833801193
2025-10-10 14:30:00-04:00,9.5649995803833,9.600000381469727,9.380000114440918,9.394000053405762,4137586,11.20009994506836,9.394000053405762,-1.8060998916625977,-0.1612574798904238
2025-10-10 15:30:00-04:00,9.395000457763672,9.404999732971191,9.190099716186523,9.21500015258789,4729650,11.069999694824219,9.21500015258789,-1.8549995422363281,-0.16756997230123083
2025-10-13 09:30:00-04:00,10.03499984741211,10.220000267028809,9.683199882507324,9.944999694824219,16394310,10.9399995803833,9.944999694824219,-0.994999885559082,-0.0909506328814887
2025-10-13 10:30:00-04:00,9.949999809265137,10.960000038146973,9.920100212097168,10.875,10435186,10.78499984741211,10.875,0.09000015258789062,0.008344937771091987
2025-10-13 11:30:00-04:00,10.869999885559082,11.09000015258789,10.819999694824219,11.069899559020996,7933719,11.13700008392334,11.069899559020996,-0.06710052490234375,-0.006025008924908403
2025-10-13 12:30:00-04:00,11.06350040435791,11.21500015258789,10.975000381469727,11.015000343322754,5608640,11.509900093078613,11.015000343322754,-0.4948997497558594,-0.04299774505023405
2025-10-13 13:30:00-04:00,11.020000457763672,11.140000343322754,10.960000038146973,11.134900093078613,3842014,11.121999740600586,11.134900093078613,0.012900352478027344,0.0011598950529494194
2025-10-13 14:30:00-04:00,11.135000228881836,11.135000228881836,10.899999618530273,10.960000038146973,3017509,11.30150032043457,10.960000038146973,-0.34150028228759766,-0.030217251922748795
2025-10-13 15:30:00-04:00,10.960000038146973,11.010000228881836,10.789999961853027,10.795000076293945,3371484,11.255000114440918,10.795000076293945,-0.46000003814697266,-0.04087072709637398
2025-10-14 09:30:00-04:00,10.380000114440918,10.5,9.880000114440918,10.345000267028809,14945972,11.150099754333496,10.345000267028809,-0.8050994873046875,-0.07220558605242836
2025-10-14 10:30:00-04:00,10.34000015258789,10.354999542236328,10.0600004196167,10.154999732971191,4694222,10.925000190734863,10.154999732971191,-0.7700004577636719,-0.07048058986915938
2025-10-14 11:30:00-04:00,10.149999618530273,10.454999923706055,10.119999885559082,10.380000114440918,4382624,10.823200225830078,10.380000114440918,-0.44320011138916016,-0.04094908180035718
2025-10-14 12:30:00-04:00,10.380000114440918,10.555000305175781,10.300000190734863,10.395000457763672,3456888,10.530099868774414,10.395000457763672,-0.1350994110107422,-0.012829831881401353
2025-10-14 13:30:00-04:00,10.399900436401367,10.470000267028809,10.350000381469727,10.4350004196167,2264032,10.640000343322754,10.4350004196167,-0.2049999237060547,-0.01926690950106074
2025-10-14 14:30:00-04:00,10.437800407409668,10.5600004196167,10.350000381469727,10.550000190734863,2451533,10.435500144958496,10.550000190734863,0.11450004577636719,0.010972166564693443
2025-10-14 15:30:00-04:00,10.550000190734863,10.5600004196167,10.25,10.418999671936035,3277250,10.489999771118164,10.418999671936035,-0.0710000991821289,-0.006768360412896441
2025-10-15 09:30:00-04:00,10.824999809265137,10.869999885559082,9.949999809265137,10.03499984741211,14122313,10.136300086975098,10.03499984741211,-0.10130023956298828,-0.009993808262756216
2025-10-15 10:30:00-04:00,10.03499984741211,10.180000305175781,9.75,9.770000457763672,9051236,9.679800033569336,9.770000457763672,0.09020042419433594,0.009318418136895682
2025-10-15 11:30:00-04:00,9.774999618530273,9.779999732971191,9.380000114440918,9.545000076293945,9580519,9.845000267028809,9.545000076293945,-0.3000001907348633,-0.03047233952238403
2025-10-15 12:30:00-04:00,9.545000076293945,9.5600004196167,9.15999984741211,9.300000190734863,6439759,9.725000381469727,9.300000190734863,-0.4250001907348633,-0.04370181738446714
2025-10-15 13:30:00-04:00,9.289999961853027,9.444999694824219,9.220000267028809,9.274999618530273,3731163,9.5649995803833,9.274999618530273,-0.28999996185302734,-0.030318868225335156
2025-10-15 14:30:00-04:00,9.279999732971191,9.510000228881836,9.279999732971191,9.5,2719663,9.394000053405762,9.5,0.10599994659423828,0.011283792419801868
2025-10-15 15:30:00-04:00,9.505000114440918,9.609999656677246,9.460000038146973,9.505000114440918,2954856,9.21500015258789,9.505000114440918,0.28999996185302734,0.03147042398817382
2025-10-16 09:30:00-04:00,9.579999923706055,9.610199928283691,8.9399995803833,8.989999771118164,14410950,9.944999694824219,8.989999771118164,-0.9549999237060547,-0.09602815012684972
2025-10-16 10:30:00-04:00,8.984999656677246,9.0600004196167,8.279999732971191,8.35990047454834,18525341,10.875,8.35990047454834,-2.51509952545166,-0.23127351958176184
2025-10-16 11:30:00-04:00,8.350000381469727,8.420000076293945,8.050000190734863,8.179900169372559,14598068,11.069899559020996,8.179900169372559,-2.8899993896484375,-0.2610682575970928
2025-10-16 12:30:00-04:00,8.170000076293945,8.329999923706055,8.109999656677246,8.265000343322754,5705997,11.015000343322754,8.265000343322754,-2.75,-0.24965954737051263
2025-10-16 13:30:00-04:00,8.270000457763672,8.300000190734863,7.929999828338623,8.0,7129690,11.134900093078613,8.0,-3.1349000930786133,-0.2815382326624779
2025-10-16 14:30:00-04:00,8.0,8.100000381469727,7.960000038146973,7.969900131225586,3930752,10.960000038146973,7.969900131225586,-2.9900999069213867,-0.2728193336235543
2025-10-16 15:30:00-04:00,7.960100173950195,8.220000267028809,7.920000076293945,8.208499908447266,4632231,10.795000076293945,8.208499908447266,-2.5865001678466797,-0.23960168129379547
2025-10-17 09:30:00-04:00,7.954999923706055,8.15999984741211,7.739999771118164,7.90500020980835,16261764,10.345000267028809,7.90500020980835,-2.440000057220459,-0.23586273506411928
2025-10-17 10:30:00-04:00,7.914999961853027,7.929900169372559,7.679999828338623,7.724999904632568,6341783,10.154999732971191,7.724999904632568,-2.429999828338623,-0.23929097904837104
2025-10-17 11:30:00-04:00,7.728499889373779,7.929999828338623,7.643599987030029,7.906400203704834,4986834,10.380000114440918,7.906400203704834,-2.473599910736084,-0.23830442037228394
2025-10-17 12:30:00-04:00,7.90500020980835,7.940000057220459,7.710000038146973,7.764999866485596,3622138,10.395000457763672,7.764999866485596,-2.630000591278076,-0.2530062987456454
2025-10-17 13:30:00-04:00,7.764999866485596,7.839900016784668,7.710000038146973,7.735000133514404,2611803,10.4350004196167,7.735000133514404,-2.700000286102295,-0.25874462650011776
2025-10-17 14:30:00-04:00,7.735000133514404,7.759900093078613,7.630000114440918,7.684999942779541,3288442,10.550000190734863,7.684999942779541,-2.8650002479553223,-0.27156399963588623
2025-10-17 15:30:00-04:00,7.684999942779541,7.695000171661377,7.554999828338623,7.585000038146973,4658702,10.418999671936035,7.585000038146973,-2.8339996337890625,-0.272003044728233
2025-10-20 09:30:00-04:00,8.068300247192383,8.1899995803833,7.329999923706055,7.585000038146973,15923638,10.03499984741211,7.585000038146973,-2.4499998092651367,-0.24414547548767113
2025-10-20 10:30:00-04:00,7.585000038146973,7.940000057220459,7.449999809265137,7.824999809265137,7445370,9.770000457763672,7.824999809265137,-1.9450006484985352,-0.19907886974078412
2025-10-20 11:30:00-04:00,7.829999923706055,7.879899978637695,7.690000057220459,7.724999904632568,3133627,9.545000076293945,7.724999904632568,-1.820000171661377,-0.19067576292446
2025-10-20 12:30:00-04:00,7.724999904632568,7.800000190734863,7.644999980926514,7.7555999755859375,2626594,9.300000190734863,7.7555999755859375,-1.5444002151489258,-0.166064535857487
2025-10-20 13:30:00-04:00,7.758999824523926,7.849999904632568,7.639999866485596,7.659999847412109,2836409,9.274999618530273,7.659999847412109,-1.614999771118164,-0.17412397170255395
2025-10-20 14:30:00-04:00,7.659999847412109,7.800000190734863,7.630000114440918,7.66480016708374,2258776,9.5,7.66480016708374,-1.8351998329162598,-0.19317892978065893
2025-10-20 15:30:00-04:00,7.662300109863281,7.769999980926514,7.650000095367432,7.769999980926514,2625018,9.505000114440918,7.769999980926514,-1.7350001335144043,-0.18253551947657778
2025-10-21 09:30:00-04:00,7.679999828338623,7.909999847412109,7.46999979019165,7.521699905395508,8399836,8.989999771118164,7.521699905395508,-1.4682998657226562,-0.16332590690823023
2025-10-21 10:30:00-04:00,7.521100044250488,7.669899940490723,7.519999980926514,7.587299823760986,2634045,8.35990047454834,7.587299823760986,-0.7726006507873535,-0.09241744601380494
2025-10-21 11:30:00-04:00,7.585000038146973,7.657299995422363,7.554999828338623,7.585000038146973,2008350,8.179900169372559,7.585000038146973,-0.5949001312255859,-0.07272706498950071
2025-10-21 12:30:00-04:00,7.590000152587891,7.605000019073486,7.349999904632568,7.364999771118164,3805118,8.265000343322754,7.364999771118164,-0.9000005722045898,-0.10889298666898364
2025-10-21 13:30:00-04:00,7.364999771118164,7.389999866485596,7.130000114440918,7.21999979019165,5038148,8.0,7.21999979019165,-0.7800002098083496,-0.0975000262260437
2025-10-21 14:30:00-04:00,7.224999904632568,7.230000019073486,7.124499797821045,7.144999980926514,3137211,7.969900131225586,7.144999980926514,-0.8249001502990723,-0.10350194315072575
2025-10-21 15:30:00-04:00,7.150000095367432,7.21999979019165,7.144999980926514,7.175000190734863,3243550,8.208499908447266,7.175000190734863,-1.0334997177124023,-0.12590603998774985
2025-10-22 09:30:00-04:00,6.849999904632568,7.260000228881836,6.78000020980835,6.849999904632568,15122260,7.90500020980835,6.849999904632568,-1.0550003051757812,-0.13345987061034612
2025-10-22 10:30:00-04:00,6.849999904632568,6.974999904632568,6.639999866485596,6.795000076293945,11895454,7.724999904632568,6.795000076293945,-0.929999828338623,-0.1203883287792555
2025-10-22 11:30:00-04:00,6.795000076293945,6.860000133514404,6.650000095367432,6.684999942779541,5551510,7.906400203704834,6.684999942779541,-1.221400260925293,-0.1544824736234527
2025-10-22 12:30:00-04:00,6.684999942779541,6.739999771118164,6.520100116729736,6.5503997802734375,6540053,7.764999866485596,6.5503997802734375,-1.2146000862121582,-0.15641984637430276
2025-10-22 13:30:00-04:00,6.550000190734863,6.619999885559082,6.465000152587891,6.609899997711182,4865989,7.735000133514404,6.609899997711182,-1.1251001358032227,-0.14545573579609394
2025-10-22 14:30:00-04:00,6.610000133514404,6.755000114440918,6.545000076293945,6.715000152587891,4319409,7.684999942779541,6.715000152587891,-0.9699997901916504,-0.12621988255224592
2025-10-22 15:30:00-04:00,6.715000152587891,6.769999980926514,6.679999828338623,6.744500160217285,4202181,7.585000038146973,6.744500160217285,-0.8404998779296875,-0.110810794159867
2025-10-23 09:30:00-04:00,6.849999904632568,6.989999771118164,6.650000095367432,6.92609977722168,7391240,7.585000038146973,6.92609977722168,-0.658900260925293,-0.08686885400283575
2025-10-23 10:30:00-04:00,6.925000190734863,7.130000114440918,6.903500080108643,6.994999885559082,6020368,7.824999809265137,6.994999885559082,-0.8299999237060547,-0.10607028037538084
2025-10-23 11:30:00-04:00,6.994999885559082,7.125,6.880000114440918,7.034999847412109,4897584,7.724999904632568,7.034999847412109,-0.690000057220459,-0.08932039685938069
2025-10-23 12:30:00-04:00,7.036300182342529,7.190000057220459,7.031199932098389,7.083499908447266,4423157,7.7555999755859375,7.083499908447266,-0.6721000671386719,-0.08665997076362807
2025-10-23 13:30:00-04:00,7.0808000564575195,7.210000038146973,7.0808000564575195,7.135000228881836,4153412,7.659999847412109,7.135000228881836,-0.5249996185302734,-0.06853781057288687
2025-10-23 14:30:00-04:00,7.144999980926514,7.300000190734863,7.119999885559082,7.15500020980835,4137119,7.66480016708374,7.15500020980835,-0.5097999572753906,-0.06651183933857945
2025-10-23 15:30:00-04:00,7.157400131225586,7.170000076293945,7.039999961853027,7.050099849700928,3766290,7.769999980926514,7.050099849700928,-0.7199001312255859,-0.09265123976740902
2025-10-24 09:30:00-04:00,7.670000076293945,8.170000076293945,7.610000133514404,7.819699764251709,19459656,7.521699905395508,7.819699764251709,0.29799985885620117,0.039618684952112786
2025-10-24 10:30:00-04:00,7.815000057220459,7.820000171661377,7.550000190734863,7.679999828338623,7699278,7.587299823760986,7.679999828338623,0.09270000457763672,0.012217785869925698
2025-10-24 11:30:00-04:00,7.675000190734863,7.889900207519531,7.620100021362305,7.7220001220703125,8335633,7.585000038146973,7.7220001220703125,0.13700008392333984,0.018061975376971677
2025-10-24 12:30:00-04:00,7.71999979019165,7.760000228881836,7.639999866485596,7.689899921417236,3622633,7.364999771118164,7.689899921417236,0.32490015029907227,0.04411407473129432
2025-10-24 13:30:00-04:00,7.679999828338623,7.683499813079834,7.550000190734863,7.59499979019165,3091334,7.21999979019165,7.59499979019165,0.375,0.05193905968105934
2025-10-24 14:30:00-04:00,7.59499979019165,7.627500057220459,7.449999809265137,7.485000133514404,3984533,7.144999980926514,7.485000133514404,0.3400001525878906,0.047585745765642645
2025-10-24 15:30:00-04:00,7.489999771118164,7.5,7.40500020980835,7.460000038146973,3959801,7.175000190734863,7.460000038146973,0.2849998474121094,0.039721232032876044
`;

function parseCSV(csv: string): Omit<StockDataPoint, 'ohlc' | 'range' | 'k' | 'd'>[] {
  const lines = csv.trim().split('\n');
  const headerLine = lines.shift();
  if (!headerLine) return [];
  
  const headers = headerLine.split(',').map(h => h.trim());
  const keyMap: { [key: string]: keyof Omit<StockDataPoint, 'ohlc' | 'range' | 'k' | 'd'> } = {
    'Datetime': 'datetime',
    'Open': 'open',
    'High': 'high',
    'Low': 'low',
    'Close': 'close',
    'Volume': 'volume',
    'P_buy': 'pBuy',
    'P_sell': 'pSell',
    'price_diff': 'priceDiff',
    'return': 'return'
  };

  return lines.map(line => {
    const values = line.split(',');
    const entry: any = {};
    headers.forEach((header, index) => {
      const key = keyMap[header];
      if (key) {
        if (key === 'datetime') {
          entry[key] = new Date(values[index]);
        } else {
          entry[key] = parseFloat(values[index]) || 0;
        }
      }
    });
    return entry as Omit<StockDataPoint, 'ohlc' | 'range' | 'k' | 'd'>;
  });
}

function calculateKD(data: StockDataPoint[], period: number = 14, dPeriod: number = 3): StockDataPoint[] {
  const dataWithK = data.map((point, index, arr) => {
    if (index < period - 1) {
      return { ...point, k: null, d: null };
    }

    const lookback = arr.slice(index - period + 1, index + 1);
    const lowestLow = Math.min(...lookback.map(p => p.low));
    const highestHigh = Math.max(...lookback.map(p => p.high));

    const kValue = highestHigh === lowestLow ? 0 : ((point.close - lowestLow) / (highestHigh - lowestLow)) * 100;
    return { ...point, k: kValue, d: null };
  });

  return dataWithK.map((point, index, arr) => {
    if (index < period - 1 + dPeriod - 1) {
      return point;
    }
    const kValues = arr.slice(index - dPeriod + 1, index + 1).map(p => p.k).filter(k => k !== null) as number[];
    if(kValues.length < dPeriod) return point;

    const dValue = kValues.reduce((sum, val) => sum + val, 0) / dPeriod;
    return { ...point, d: dValue };
  });
}

export const parseAndProcessStockData = (): StockDataPoint[] => {
    const parsed = parseCSV(rawCsvData);
    
    // Add candlestick specific fields
    let processed = parsed.map(d => ({
        ...d,
        ohlc: [d.open, d.high, d.low, d.close] as [number, number, number, number],
        range: [d.low, d.high] as [number, number]
    }));
    
    // Calculate KD
    processed = calculateKD(processed);

    return processed;
};
